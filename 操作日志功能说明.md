# 车辆调度管理系统 - 操作日志功能说明

## 📋 功能概述

操作日志功能为系统管理员提供完整的系统操作审计和追踪能力，记录所有用户操作行为，用于安全审计、问题排查和合规性检查。

## 🎯 功能特性

### ✅ 已实现功能

1. **完整操作记录**
   - 用户登录/登出记录
   - 用户管理操作（增删改查）
   - 车辆管理操作
   - 任务管理操作
   - 系统管理操作

2. **多维度日志管理**
   - 操作类型筛选（创建、更新、删除、登录等）
   - 实体类型筛选（用户、车辆、任务、系统等）
   - 时间范围筛选
   - 用户筛选

3. **日志统计分析**
   - 操作类型统计
   - 实体类型统计
   - 时间段统计
   - 用户活跃度分析

4. **日志维护功能**
   - 旧日志清理
   - 日志导出
   - 存储容量管理

## 📊 日志记录范围

### **用户操作**
- 用户登录系统
- 用户登出系统
- 用户注册（通过注册界面）
- 密码重置

### **管理员操作**
- 用户添加、编辑、删除
- 用户角色修改
- 密码重置操作
- 查看操作日志
- 数据备份操作

### **业务操作**
- 车辆添加、删除
- 任务创建、删除
- 车辆状态更新
- 任务分配操作

### **系统操作**
- 数据备份
- 日志清理
- 系统配置修改

## 🔐 安全特性

### **数据完整性**
- 所有操作强制记录
- 日志数据不可修改
- 时间戳防篡改

### **权限控制**
- 日志查看仅限管理员
- 敏感操作特殊标记
- 权限变更历史追踪

### **审计追踪**
- 操作者身份记录
- 操作时间精确记录
- 操作结果状态记录

## 🎨 用户界面说明

### **日志查看界面**
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 操作日志管理                                                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 筛选条件:                                                                       │
│ 操作类型: [全部 ▼]  实体类型: [全部 ▼]                                         │
│ 开始日期: [日期选择器]  结束日期: [日期选择器]                                 │
│ [筛选] [刷新] [清理旧日志] [导出日志]                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 日志表格:                                                                       │
│ ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐ │
│ │    时间    │  操作用户  │  操作类型  │  实体类型  │  实体ID    │  操作描述  │ │
│ ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤ │
│ │ 2025-12-23 │ admin      │ 创建       │ 用户       │ john_doe   │ 创建新用户   │ │
│ │ 2025-12-23 │ driver1    │ 登录       │ 用户       │ driver1    │ 用户登录     │ │
│ └────────────┴────────────┴────────────┴────────────┴────────────┴────────────┘ │
├─────────────────────────────────────────────────────────────────────────────────┤
│ [日志统计] [关闭]                                                               │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### **日志统计界面**
```
操作日志统计信息

总日志数: 1,250

按操作类型统计:
• 登录: 450 次 (36%)
• 更新: 320 次 (25.6%)
• 创建: 280 次 (22.4%)
• 删除: 150 次 (12%)
• 查看: 50 次 (4%)
```

## 📋 日志数据结构

### **OperationLog 实体**
```java
public class OperationLog {
    private int id;                    // 主键ID
    private String operationType;      // 操作类型 (CREATE/UPDATE/DELETE/LOGIN/LOGOUT)
    private String entityType;         // 实体类型 (USER/VEHICLE/TASK/SYSTEM)
    private String entityId;           // 实体ID (用户名/车辆ID/任务名等)
    private String description;        // 操作详细描述
    private Integer userId;            // 操作用户ID (可为空，系统操作)
    private LocalDateTime createdAt;   // 操作时间
}
```

### **操作类型常量**
- `CREATE`: 创建操作
- `UPDATE`: 更新操作
- `DELETE`: 删除操作
- `LOGIN`: 用户登录
- `LOGOUT`: 用户登出
- `VIEW`: 查看操作
- `EXPORT`: 导出操作
- `IMPORT`: 导入操作
- `BACKUP`: 备份操作
- `RESTORE`: 恢复操作

### **实体类型常量**
- `USER`: 用户相关操作
- `VEHICLE`: 车辆相关操作
- `TASK`: 任务相关操作
- `SYSTEM`: 系统相关操作
- `LOG`: 日志相关操作

## 🔄 业务流程

### **日志记录流程**
```
用户操作触发
    │
    ▼
执行业务逻辑 ──▶ 生成日志记录 ──▶ 写入数据库
    │                     │
    ▼                     ▼
返回操作结果 ◄───── 日志记录确认
```

### **日志查询流程**
```
管理员请求查看日志
    │
    ▼
权限验证 ──▶ 参数验证 ──▶ 数据库查询 ──▶ 结果过滤
    │                     │                 │
    ▼                     ▼                 ▼
权限不足 ◄───── 查询失败 ◄─────── 返回结果
```

### **日志清理流程**
```
管理员发起清理请求
    │
    ▼
确认清理范围 ──▶ 执行清理操作 ──▶ 更新统计信息
    │                     │
    ▼                     ▼
取消操作 ◄───── 清理完成
```

## 📊 统计分析功能

### **操作类型统计**
- 显示各类操作的执行次数和占比
- 识别系统使用热点和异常模式

### **用户活跃度分析**
- 统计各用户的操作频率
- 识别活跃用户和异常账户

### **时间趋势分析**
- 按日/周/月统计操作趋势
- 识别业务高峰期和异常时段

### **实体操作统计**
- 统计各实体的操作频率
- 识别频繁变更的业务对象

## 🛠️ 技术实现

### **核心组件**
- `OperationLog.java`: 日志实体模型
- `OperationLogDAO.java`: 数据访问对象
- `DataStore.java`: 日志数据管理接口
- `MainView.java`: 日志管理界面

### **数据库设计**
```sql
CREATE TABLE operation_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    operation_type VARCHAR(20) NOT NULL,
    entity_type VARCHAR(20) NOT NULL,
    entity_id VARCHAR(50),
    description TEXT,
    user_id INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_log_operation (operation_type),
    INDEX idx_log_created (created_at),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);
```

### **性能优化**
- 索引优化查询性能
- 分页加载大数据量
- 异步日志写入
- 定期清理过期日志

## 📈 扩展规划

### **未来功能**
1. **实时日志监控**: WebSocket 实时推送新日志
2. **日志告警机制**: 异常操作自动告警
3. **高级搜索**: 全文搜索和复杂条件查询
4. **日志备份**: 自动备份和归档策略
5. **审计报告**: 自动生成合规性报告

### **性能优化**
1. **分布式日志**: 支持多服务器日志聚合
2. **日志压缩**: 历史日志自动压缩存储
3. **缓存机制**: 热点数据缓存优化
4. **并行处理**: 并发日志处理优化

## 🔧 配置与维护

### **配置参数**
- 日志保留天数: 默认 365 天
- 最大日志条数: 默认 100,000 条
- 自动清理频率: 默认每日执行

### **维护任务**
- 定期检查日志存储空间
- 监控日志写入性能
- 清理过期日志记录
- 备份重要日志数据

## 📝 使用指南

### **查看操作日志**
1. 以管理员身份登录系统
2. 点击"操作日志"按钮
3. 使用筛选条件过滤日志
4. 查看详细的操作记录

### **日志统计分析**
1. 在日志界面点击"日志统计"
2. 查看各类统计信息
3. 分析系统使用情况

### **日志维护**
1. 点击"清理旧日志"清理过期记录
2. 点击"导出日志"导出日志数据
3. 定期检查日志存储状态

## ⚠️ 注意事项

### **安全提醒**
- 日志数据不得随意修改
- 管理员操作需谨慎记录
- 定期审查日志异常情况

### **性能考虑**
- 大量日志影响查询性能
- 定期清理过期日志
- 监控数据库存储空间

### **合规性要求**
- 保存审计日志不少于 3 年
- 保护用户隐私数据
- 支持监管机构查询

---

**版本信息**: v1.0.0
**最后更新**: 2025-12-23
**负责人**: 系统管理员





