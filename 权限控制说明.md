# 车辆调度管理系统权限控制说明

## 功能概述

系统实现了"用户只能删除自己添加的信息"的权限控制功能。

## 权限规则

### 车辆管理

- **添加车辆**：所有登录用户都可以添加车辆
- **删除车辆**：
  - 管理员：可以删除所有车辆
  - 普通用户：只能删除自己添加的车辆

### 任务管理

- **添加任务**：所有登录用户都可以添加任务
- **删除任务**：
  - 管理员：可以删除所有任务
  - 普通用户：只能删除自己添加的任务

### 其他功能

- **查看信息**：所有登录用户都可以查看所有车辆和任务
- **分配车辆**：只有管理员可以分配车辆给任务
- **用户管理**：只有管理员可以管理用户账号

## 技术实现

### 数据库变更

- `vehicles`表添加`created_by`字段，关联到`users.id`
- `tasks`表添加`created_by`字段，关联到`users.id`
- 添加外键约束和索引

### 代码变更

- Vehicle 和 Task 模型添加`createdBy`字段
- DAO 类支持创建者信息的查询和保存
- UI 界面实现权限检查逻辑

### 权限检查逻辑

```java
// 检查是否可以删除车辆/任务
boolean canDelete = isAdmin || (item.getCreatedBy() == currentUser.getId());
```

## 使用方法

1. **运行数据库迁移脚本**：

   ```sql
   -- 执行 add_created_by_migration.sql
   ```

2. **重启应用程序**：

   - 新添加的车辆和任务会自动记录创建者
   - 现有数据默认归属管理员账号

3. **权限测试**：
   - 用普通用户账号添加车辆/任务
   - 尝试删除自己和其他人添加的记录
   - 验证权限提示是否正确

## 注意事项

- 现有数据库需要运行迁移脚本
- 新安装的系统会自动创建正确的表结构
- 删除用户时，其创建的数据会保留（外键设置为 SET NULL）
